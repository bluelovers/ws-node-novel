{"version":3,"file":"util.js","sourceRoot":"","sources":["util.ts"],"names":[],"mappings":";AAAA;;GAEG;;AAGH,mCAAiC;AACjC,2CAAsC;AAEtC,SAAgB,cAAc,CAAC,KAAK;IAEnC,OAAO,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;AACnD,CAAC;AAHD,wCAGC;AAED,SAAgB,eAAe,CAAC,KAAK;IAEpC,OAAO,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,MAAM,IAAI,CAAC,IAAI,OAAO,KAAK,CAAC,CAAC,CAAC,IAAI,UAAU,CAAC;AACnF,CAAC;AAHD,0CAGC;AAED,SAAgB,eAAe,CAAC,KAAK;IAEpC,OAAO,OAAO,KAAK,CAAC,CAAC,IAAI,QAAQ,IAAI,IAAI,MAAM,CAAC,GAAG,cAAM,OAAO,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACjF,CAAC;AAHD,0CAGC;AAED,SAAgB,iBAAiB,CAAC,IAAY,EAAE,OAA2B;IAE1E,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,EAChC;QACC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,GAAG,oBAAY,CAAC,IAAI,CAAC,CAAC;QAEzC,IAAI,GAAG,GAAG,CAAC,EACX;YACC,OAAO,CAAC,SAAS,GAAG,KAAK,CAAC;SAC1B;QAED,IAAI,GAAG,IAAI,CAAC,EACZ;YACC,IAAI,GAAG,GAAG,CAAC,EACX;gBACC,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,OAAO,GAAG,GAAG,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC;gBAEjD,IAAI,GAAG,IAAI;oBACX,+BAA+B;qBAC7B,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC,CACjB;aACD;YAED,IAAI,GAAG,IAAI;iBACT,OAAO,CAAC,SAAS,EAAE,QAAQ,CAAC,CAE7B;SACD;QAED,uBAAuB;QAEvB,IAAI,CAAC,OAAO,CAAC,SAAS,EACtB;YACC,IAAI,GAAG,IAAI;iBACT,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CACvB;SACD;KACD;IAED;;;;;;;;;;;;MAYE;IAEF,IAAI,GAAG,IAAI;SACT,OAAO,CAAC,oBAAoB,EAAE,EAAE,CAAC;SACjC,OAAO,CAAC,WAAW,uBAAa,CACjC;IAED,IAAI,OAAO,CAAC,SAAS,EACrB;QACC,IAAI,GAAG,IAAI;aACT,OAAO,CAAC,WAAW,qBAAa,CACjC;KACD;SAED;QACC,IAAI,GAAG,IAAI;aACT,OAAO,CAAC,UAAU,mBAAa,CAChC;KACD;IAED,OAAO,IAAI,CAAC;AACb,CAAC;AAxED,8CAwEC","sourcesContent":["/**\n * Created by user on 2019/5/29.\n */\n\nimport { EnumLF, ITextLayoutOptions, IWordsArray, IWordsArray2, IWordsUserSP } from './types';\nimport { SP_KEY } from './index';\nimport getMinMidMax from 'blank-line';\n\nexport function _isIwordsArray(value): value is IWordsArray\n{\n\treturn Array.isArray(value) && (value.length > 1);\n}\n\nexport function _isIwordsArray2(value): value is IWordsArray2\n{\n\treturn Array.isArray(value) && value.length == 1 && typeof value[0] == 'function';\n}\n\nexport function _isIwordsUserSp(value): value is IWordsUserSP\n{\n\treturn typeof value.s == 'string' && new RegExp(`${SP_KEY}(.+)$`).test(value.s);\n}\n\nexport function _handleTextLayout(html: string, options: ITextLayoutOptions): string\n{\n\tif (!html.match(/[^\\n]\\n[^\\n]/g))\n\t{\n\t\tlet [min, mid, max] = getMinMidMax(html);\n\n\t\tif (min > 2)\n\t\t{\n\t\t\toptions.allow_lf2 = false;\n\t\t}\n\n\t\tif (max >= 3)\n\t\t{\n\t\t\tif (min > 2)\n\t\t\t{\n\t\t\t\tlet r = new RegExp(`\\\\n{${min - 1}}(\\\\n+)`, 'g');\n\n\t\t\t\thtml = html\n\t\t\t\t//.replace(/\\n{2}(\\n*)/g, '$1')\n\t\t\t\t\t.replace(r, '$1')\n\t\t\t\t;\n\t\t\t}\n\n\t\t\thtml = html\n\t\t\t\t.replace(/\\n{3,}/g, \"\\n\\n\\n\")\n\t\t\t//.replace(/\\n{2}/g, \"\\n\")\n\t\t\t;\n\t\t}\n\n\t\t//console.log(options);\n\n\t\tif (!options.allow_lf2)\n\t\t{\n\t\t\thtml = html\n\t\t\t\t.replace(/\\n\\n/g, \"\\n\")\n\t\t\t;\n\t\t}\n\t}\n\n\t/*\n\thtml = html\n\t// for ts\n\t\t.toString()\n\t\t.replace(/([^\\n「」【】《》“”『』（）\\[\\]\"](?:[！？?!。]*)?)\\n((?:[—]+)?[「」“”【】《》（）『』])/ug, \"$1\\n\\n$2\")\n\n\t\t.replace(/([「」【】《》“”『』（）―\\[\\]\"](?:[！？?!。]*)?)\\n((?:\\u3000*)[^\\n「」“”【】《》（）『』])/ug, \"$1\\n\\n$2\")\n\n\t\t.replace(/([^\\n「」【】《》“”『』（）\\[\\]\"≪≫](?:[！？?!。]*)?)\\n((?:[—]+)?[≪≫「」“”【】《》（）『』])/ug, \"$1\\n\\n$2\")\n\n\t\t.replace(/(）(?:[！？?!。]*)?)\\n([「」【】《》『』“”])/ug, \"$1\\n\\n$2\")\n\t;\n\t*/\n\n\thtml = html\n\t\t.replace(/^\\n+|[\\s\\u3000]+$/g, '')\n\t\t.replace(/(\\n){4,}/g, EnumLF.LF4)\n\t;\n\n\tif (options.allow_lf3)\n\t{\n\t\thtml = html\n\t\t\t.replace(/(\\n){3,}/g, EnumLF.LF3)\n\t\t;\n\t}\n\telse\n\t{\n\t\thtml = html\n\t\t\t.replace(/(\\n){3}/g, EnumLF.LF2)\n\t\t;\n\t}\n\n\treturn html;\n}\n"]}