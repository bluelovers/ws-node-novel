{"version":3,"file":"split.js","sourceRoot":"","sources":["split.ts"],"names":[],"mappings":";;AAAA,iCAA4C;AAY5C,uCAAmC;AACnC,uCAAoC;AAEpC,SAAgB,eAAe,CAAiC,GAAa,EAAE,KAAQ;IAEtF,IAAI,GAAiB,CAAC;IAEtB,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;IAElB,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,EAChD;QACC,MAAM,IAAI,UAAU,CAAC,+BAA+B,CAAC,CAAA;KACrD;IAED,IAAI,KAAK,CAAC,WAAW,EACrB;QACC,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;KACzB;IAED,IAAI,EACJ,IAAI,KAAK,CAAC,MAAM,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,EACzC;QACC,IAAI,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;QAExB,IAAI,EAAE,GAAG,kBAAO,CAAC,EAAE,EAAE,GAAG,EAAE;YACzB,WAAW;SACX,CAAC,CAAC;QAEH,6BAA6B;QAC7B,6BAA6B;QAE7B,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM,EACrB;YACC,IAAI,GAAG,GAAG,yBAAyB,EAAE,EAAE,CAAC;YAExC,iBAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAElB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,EAC9B;gBACC,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;aACrB;YAED,MAAM,IAAI,CAAC;SACX;QAED,oCAAoC;QAEpC,GAAG,GAAG,gBAAgB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;KACrD;IAED,IAAI,CAAC,GAAG,EACR;QACC,GAAG,GAAG,EAAE,CAAC;QACT,GAAG,CAAC,cAAc,CAAC,GAAG,GAAG,CAAC;KAC1B;IAED,IAAI,IAAI,GAAgB,EAAE,CAAC;IAE3B,aAAa;IACb,KAAK,CAAC,EAAE,GAAG,CAAC,CAAC;IAEb,KAAK,IAAI,EAAE,IAAI,GAAG,EAClB;QACC,IAAI,GAAG,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC;QAElB,IAAI,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;QACzB,IAAI,EAAE,GAAG,kBAAO,CAAC,EAAE,EAAE,GAAG,EAAE;YACzB,WAAW;SACX,CAAC,CAAC;QAEH,2BAA2B;QAE3B,wBAAwB;QAExB,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM,EACrB;YACC,aAAa;YACb,IAAI,EAAE,GAAG,eAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;YAEtC,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;YAEd,IAAI,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,SAAS,CAAC,GAAG,GAAG,CAAC;YAE/B,SAAS;SACT;QAED,IAAI,GAAG,GAAG,gBAAgB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;QAE1D,IAAI,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC;QAEd,KAAK,IAAI,EAAE,IAAI,GAAG,EAClB;YACC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC;SACvB;KACD;IAED,SAAS,WAAW,CAAC,EAAE;QAEtB,IAAI,KAAK,GAAG,CAAC,EAAE,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;QAE7B,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAC7B;YACC,KAAK,IAAI,GAAG,CAAC;SACb;QAED,aAAa;QACb,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,IAAI,MAAM,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;QAEtD,OAAO,CAAC,CAAA;IACT,CAAC;IAED,oBAAoB;IAEpB,OAAO,IAAI,CAAC;AACb,CAAC;AA/GD,0CA+GC;AAED,SAAgB,gBAAgB,CAAiC,GAAa,EAAE,KAAQ,EAAE,EAAe,EAAE,WAAyB;IAEnI,IAAI,MAAM,GAAiB,EAAE,CAAC;IAC9B,IAAI,GAAG,GAAG,CAAC,CAAC;IAEZ,IAAI,EAAE,EAAE,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,WAAW,CAAC;IAE7C,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;IAElB,aAAa;IACb,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC;IAEhB,IAAI,MAAM,CAAC;IAEX,IAAI,CAAS,CAAC;IACd,IAAI,EAAE,GAAG,KAAK,CAAC,EAAE,IAAI,CAAC,CAAC;IACvB,IAAI,EAAU,CAAC;IACf,IAAI,EAAE,GAAW,CAAC,CAAC;IACnB,IAAI,MAAM,GAAG,KAAK,CAAC,MAAM,IAAI,CAAC,CAAC;IAE/B,IAAI,SAAS,GAAW,CAAC,CAAC;IAE1B,IAAI,SAAiB,CAAC;IACtB,IAAI,UAAmB,CAAC;IACxB,IAAI,KAAa,CAAC;IAElB,KAAK,CAAC,IAAI,EAAE,EACZ;QACC,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;QAEpB,EAAE,GAAG,CAAC,KAAK,GAAG,EAAE,GAAG,SAAS,CAAC,CAAC,QAAQ,EAAE,CAAC;QAEzC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;QAEd,IAAI,QAAQ,EACZ;YACC,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,EAC1B;gBACC;;mBAEG;gBACH,SAAS;aACT;YAED,QAAQ,CAAC,SAAS,GAAG,CAAC,CAAC;SACvB;QAED,IAAI,CAAC,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,EACvC;YACC,iBAAiB;YAEjB,IAAI,EAAE,GAAG,eAAQ,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;YAC9B,IAAI,IAAI,GAAG,QAAQ,CAAC;YAEpB,IAAI,QAAQ,IAAI,QAAQ,CAAC;gBACxB,CAAC;gBACD,EAAE;gBACF,IAAI;gBACJ,CAAC;gBACD,MAAM;gBACN,MAAM;gBACN,EAAE;gBACF,KAAK;gBACL,GAAG;gBAEH,EAAE;gBACF,MAAM;gBACN,EAAE;aACF,CAAC,EACF;gBACC,SAAS;aACT;YAED,IAAI,EAAE,EACN;gBACC,IAAI,IAAI,GAAG,EAAE,CAAC;oBACb,CAAC;oBACD,EAAE;oBACF,IAAI;oBACJ,CAAC;oBACD,MAAM;oBACN,MAAM;oBACN,EAAE;oBACF,KAAK;oBACL,GAAG;oBAEH,EAAE;oBACF,MAAM;oBACN,EAAE;iBACF,CAAC,CAAC;gBAEH,IAAI,IAAI,EACR;oBACC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;oBACb,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;oBACjB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;iBACf;aACD;YAED,IAAI,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;YAEvC,IAAI,GAAG,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC;YAEvB,IAAI,QAAQ,CAAC,MAAM,EACnB;gBACC,IAAI,UAAU,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,MAAM,EAC9D;oBACC,UAAU,GAAG,KAAK,CAAC;oBAEnB,SAAS,EAAE,CAAC;iBACZ;qBAED;oBACC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,QAAQ,CAAC;oBAEpC,EAAE,EAAE,CAAC;oBAEL,UAAU,GAAG,IAAI,CAAC;iBAClB;gBAED,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC;aACd;SACD;aACI,IAAI,MAAM,EACf;YACC,IAAI,EAAE,GAAG,eAAQ,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;YAC9B,IAAI,IAAI,GAAG,eAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAElC,IAAI,QAAQ,IAAI,QAAQ,CAAC;gBACxB,CAAC;gBACD,EAAE;gBACF,IAAI;gBACJ,CAAC;gBACD,MAAM;gBACN,MAAM;gBACN,EAAE;gBACF,KAAK;gBACL,GAAG;gBAEH,EAAE;gBACF,MAAM;gBACN,EAAE;aACF,CAAC,EACF;gBACC,SAAS;aACT;YAED,IAAI,EAAE,EACN;gBACC,IAAI,IAAI,GAAG,EAAE,CAAC;oBACb,CAAC;oBACD,EAAE;oBACF,IAAI;oBACJ,CAAC;oBACD,MAAM;oBACN,MAAM;oBACN,EAAE;oBACF,KAAK;oBACL,GAAG;oBAEH,EAAE;oBACF,MAAM;oBACN,EAAE;iBACF,CAAC,CAAC;gBAEH,IAAI,IAAI,EACR;oBACC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;oBACb,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;oBACjB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;iBACf;aACD;YAED,IAAI,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC;YAEvC,IAAI,GAAG,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC;YAEvB,IAAI,QAAQ,CAAC,MAAM,EACnB;gBACC,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,QAAQ,CAAC;gBAEpC,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC;gBAEd,EAAE,EAAE,CAAC;aACL;SACD;QAED,MAAM,GAAG,CAAC,CAAC;KACX;IAED,KAAK,EACL,IAAI,GAAG,GAAG,GAAG,CAAC,MAAM,GAAG,CAAC,EACxB;QACC,EAAE,GAAG,CAAC,KAAK,GAAG,EAAE,GAAG,CAAC,GAAG,SAAS,CAAC,CAAC,QAAQ,EAAE,CAAC;QAE7C,IAAI,EAAE,GAAG,eAAQ,CAAC,EAAE,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;QAC9B,IAAI,IAAI,GAAG,eAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAElC,MAAM,MAAM,GAAG,EAAE,CAAC;QAElB,IAAI,KAAc,CAAC;QAEnB,IAAI,QAAQ,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,EAC3C;YACC,KAAK,GAAG,IAAI,CAAC;SACb;aACI,IAAI,QAAQ,IAAI,QAAQ,CAAC;YAC7B,CAAC;YACD,EAAE;YACF,IAAI;YACJ,CAAC,EAAE,IAAI;YACP,MAAM;YACN,MAAM;YACN,EAAE;YACF,KAAK;YACL,GAAG;YAEH,EAAE;YACF,MAAM;YACN,EAAE;SACF,CAAC,EACF;YACC,KAAK,GAAG,IAAI,CAAC;SACb;QAED,IAAI,KAAK,EACT;YACC,MAAM,CAAC,SAAS,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAEpC,MAAM,KAAK,CAAC;SACZ;QAED,IAAI,EAAE,EACN;YACC,IAAI,CAAC,CAAC;YAEN,IAAI,IAAI,GAAG,EAAE,CAAC;gBACb,CAAC;gBACD,EAAE;gBACF,IAAI;gBACJ,CAAC;gBACD,MAAM;gBACN,MAAM;gBACN,EAAE;gBACF,KAAK;gBACL,GAAG;gBAEH,EAAE;gBACF,MAAM;gBACN,EAAE;aACF,CAAC,CAAC;YAEH,IAAI,IAAI,EACR;gBACC,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;gBACb,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;gBACjB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;aACf;SACD;QAED,IAAI,GAAG,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;QAE1C,MAAM,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;KAC9B;IAED,aAAa;IACb,KAAK,CAAC,EAAE,GAAG,QAAQ,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;IAE5B,OAAO,MAAM,CAAC;AACf,CAAC;AA7QD,4CA6QC","sourcesContent":["import { fix_name, padIndex } from './util';\nimport {\n\tIContext,\n\tIDataChapter,\n\tIDataVolume,\n\tIOptions,\n\tISplitCache,\n\tISplitCB,\n\tISplitMatch,\n\tISplitMatchItem,\n\tIOptionsRequired, ISplitOption,\n} from './interface';\nimport { execall } from 'execall2';\nimport { console } from './console';\n\nexport function splitVolumeSync<O extends Partial<ISplitCache>>(txt: IContext, cache: O): IDataVolume\n{\n\tlet _vs: IDataChapter;\n\n\ttxt = String(txt);\n\n\tif (!cache || !cache.chapter || !cache.chapter.r)\n\t{\n\t\tthrow new RangeError(`options.chapter.r is required`)\n\t}\n\n\tif (cache.beforeStart)\n\t{\n\t\tcache.beforeStart(cache);\n\t}\n\n\tMAIN:\n\tif (cache.volume && !cache.volume.disable)\n\t{\n\t\tlet _r = cache.volume.r;\n\n\t\tlet _m = execall(_r, txt, {\n\t\t\tcloneRegexp,\n\t\t});\n\n\t\t//console.debug(_r, _m, txt);\n\t\t//console.debug(_r, _m, txt);\n\n\t\tif (!_m || !_m.length)\n\t\t{\n\t\t\tlet msg = `volume match is empty ${_r}`;\n\n\t\t\tconsole.warn(msg);\n\n\t\t\tif (!cache.volume.allowNoMatch)\n\t\t\t{\n\t\t\t\tthrow new Error(msg);\n\t\t\t}\n\n\t\t\tbreak MAIN;\n\t\t}\n\n\t\t//console.log(_r, _m, _r.test(txt));\n\n\t\t_vs = splitChapterSync(txt, cache, _m, cache.volume);\n\t}\n\n\tif (!_vs)\n\t{\n\t\t_vs = {};\n\t\t_vs['00000_unknow'] = txt;\n\t}\n\n\tlet _out: IDataVolume = {};\n\n\t// @ts-ignore\n\tcache.ix = 0;\n\n\tfor (let vn in _vs)\n\t{\n\t\tlet txt = _vs[vn];\n\n\t\tlet _r = cache.chapter.r;\n\t\tlet _m = execall(_r, txt, {\n\t\t\tcloneRegexp,\n\t\t});\n\n\t\t//console.log(_r, _m, txt);\n\n\t\t//console.log(cache.ix);\n\n\t\tif (!_m || !_m.length)\n\t\t{\n\t\t\t// @ts-ignore\n\t\t\tlet id = padIndex(cache.ix++, 5, '0');\n\n\t\t\t_out[vn] = {};\n\n\t\t\t_out[vn][`${id}_unknow`] = txt;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet _cs = splitChapterSync(txt, cache, _m, cache.chapter);\n\n\t\t_out[vn] = {};\n\n\t\tfor (let cn in _cs)\n\t\t{\n\t\t\t_out[vn][cn] = _cs[cn];\n\t\t}\n\t}\n\n\tfunction cloneRegexp(re)\n\t{\n\t\tlet flags = (re.flags || '');\n\n\t\tif (flags.indexOf('g') === -1)\n\t\t{\n\t\t\tflags += 'g';\n\t\t}\n\n\t\t// @ts-ignore\n\t\tlet r = new (cache.useRegExpCJK || RegExp)(re, flags);\n\n\t\treturn r\n\t}\n\n\t//console.log(_out);\n\n\treturn _out;\n}\n\nexport function splitChapterSync<O extends Partial<ISplitCache>>(txt: IContext, cache: O, _m: ISplitMatch, splitOption: ISplitOption): IDataChapter<string>\n{\n\tlet _files: IDataChapter = {};\n\tlet idx = 0;\n\n\tlet { cb, ignoreCb, ignoreRe } = splitOption;\n\n\ttxt = String(txt);\n\n\t// @ts-ignore\n\tcache.txt = txt;\n\n\tlet m_last;\n\n\tlet i: string;\n\tlet ix = cache.ix || 0;\n\tlet ii: string;\n\tlet ic: number = 0;\n\tlet ic_all = cache.ic_all || 0;\n\n\tlet ii_rebase: number = 0;\n\n\tlet name_last: string;\n\tlet has_unknow: boolean;\n\tlet i_int: number;\n\n\tfor (i in _m)\n\t{\n\t\ti_int = parseInt(i);\n\n\t\tii = (i_int + ix - ii_rebase).toString();\n\n\t\tlet m = _m[i];\n\n\t\tif (ignoreRe)\n\t\t{\n\t\t\tif (ignoreRe.test(m.match))\n\t\t\t{\n\t\t\t\t/**\n\t\t\t\t * @todo here maybe will has bug, need test\n\t\t\t\t */\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tignoreRe.lastIndex = 0;\n\t\t}\n\n\t\tif (!m_last && idx == 0 && m.index != 0)\n\t\t{\n\t\t\t//console.log(m);\n\n\t\t\tlet id = padIndex(ii, 5, '0');\n\t\t\tlet name = 'unknow';\n\n\t\t\tif (ignoreCb && ignoreCb({\n\t\t\t\ti,\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tm,\n\t\t\t\tm_last,\n\t\t\t\t_files,\n\t\t\t\tii,\n\t\t\t\tcache,\n\t\t\t\tidx,\n\n\t\t\t\tic,\n\t\t\t\tic_all,\n\t\t\t\tix,\n\t\t\t}))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (cb)\n\t\t\t{\n\t\t\t\tlet _ret = cb({\n\t\t\t\t\ti,\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tm,\n\t\t\t\t\tm_last,\n\t\t\t\t\t_files,\n\t\t\t\t\tii,\n\t\t\t\t\tcache,\n\t\t\t\t\tidx,\n\n\t\t\t\t\tic,\n\t\t\t\t\tic_all,\n\t\t\t\t\tix,\n\t\t\t\t});\n\n\t\t\t\tif (_ret)\n\t\t\t\t{\n\t\t\t\t\tid = _ret.id;\n\t\t\t\t\tname = _ret.name;\n\t\t\t\t\tidx = _ret.idx;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet txt_clip = txt.slice(idx, m.index);\n\n\t\t\tname = id + '_' + name;\n\n\t\t\tif (txt_clip.length)\n\t\t\t{\n\t\t\t\tif (has_unknow == null && !txt_clip.replace(/\\s+/g, '').length)\n\t\t\t\t{\n\t\t\t\t\thas_unknow = false;\n\n\t\t\t\t\tii_rebase++;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t_files[name_last = name] = txt_clip;\n\n\t\t\t\t\tic++;\n\n\t\t\t\t\thas_unknow = true;\n\t\t\t\t}\n\n\t\t\t\tidx = m.index;\n\t\t\t}\n\t\t}\n\t\telse if (m_last)\n\t\t{\n\t\t\tlet id = padIndex(ii, 5, '0');\n\t\t\tlet name = fix_name(m_last.match);\n\n\t\t\tif (ignoreCb && ignoreCb({\n\t\t\t\ti,\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tm,\n\t\t\t\tm_last,\n\t\t\t\t_files,\n\t\t\t\tii,\n\t\t\t\tcache,\n\t\t\t\tidx,\n\n\t\t\t\tic,\n\t\t\t\tic_all,\n\t\t\t\tix,\n\t\t\t}))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (cb)\n\t\t\t{\n\t\t\t\tlet _ret = cb({\n\t\t\t\t\ti,\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tm,\n\t\t\t\t\tm_last,\n\t\t\t\t\t_files,\n\t\t\t\t\tii,\n\t\t\t\t\tcache,\n\t\t\t\t\tidx,\n\n\t\t\t\t\tic,\n\t\t\t\t\tic_all,\n\t\t\t\t\tix,\n\t\t\t\t});\n\n\t\t\t\tif (_ret)\n\t\t\t\t{\n\t\t\t\t\tid = _ret.id;\n\t\t\t\t\tname = _ret.name;\n\t\t\t\t\tidx = _ret.idx;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet txt_clip = txt.slice(idx, m.index);\n\n\t\t\tname = id + '_' + name;\n\n\t\t\tif (txt_clip.length)\n\t\t\t{\n\t\t\t\t_files[name_last = name] = txt_clip;\n\n\t\t\t\tidx = m.index;\n\n\t\t\t\tic++;\n\t\t\t}\n\t\t}\n\n\t\tm_last = m;\n\t}\n\n\tMAIN2:\n\tif (idx < txt.length - 1)\n\t{\n\t\tii = (i_int + ix + 1 - ii_rebase).toString();\n\n\t\tlet id = padIndex(ii, 5, '0');\n\t\tlet name = fix_name(m_last.match);\n\n\t\tconst id_old = id;\n\n\t\tlet _skip: boolean;\n\n\t\tif (ignoreRe && ignoreRe.test(m_last.match))\n\t\t{\n\t\t\t_skip = true;\n\t\t}\n\t\telse if (ignoreCb && ignoreCb({\n\t\t\ti,\n\t\t\tid,\n\t\t\tname,\n\t\t\tm: null,\n\t\t\tm_last,\n\t\t\t_files,\n\t\t\tii,\n\t\t\tcache,\n\t\t\tidx,\n\n\t\t\tic,\n\t\t\tic_all,\n\t\t\tix,\n\t\t}))\n\t\t{\n\t\t\t_skip = true;\n\t\t}\n\n\t\tif (_skip)\n\t\t{\n\t\t\t_files[name_last] += txt.slice(idx);\n\n\t\t\tbreak MAIN2;\n\t\t}\n\n\t\tif (cb)\n\t\t{\n\t\t\tlet m;\n\n\t\t\tlet _ret = cb({\n\t\t\t\ti,\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tm,\n\t\t\t\tm_last,\n\t\t\t\t_files,\n\t\t\t\tii,\n\t\t\t\tcache,\n\t\t\t\tidx,\n\n\t\t\t\tic,\n\t\t\t\tic_all,\n\t\t\t\tix,\n\t\t\t});\n\n\t\t\tif (_ret)\n\t\t\t{\n\t\t\t\tid = _ret.id;\n\t\t\t\tname = _ret.name;\n\t\t\t\tidx = _ret.idx;\n\t\t\t}\n\t\t}\n\n\t\tname = (id !== '' ? id + '_' : '') + name;\n\n\t\t_files[name] = txt.slice(idx);\n\t}\n\n\t// @ts-ignore\n\tcache.ix = parseInt(ii) + 1;\n\n\treturn _files;\n}\n"]}