"use strict";
/**
 * Created by user on 2018/2/12/012.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const naturalCompare = require("string-natural-compare");
exports.naturalCompare = naturalCompare;
var EnumToLowerCase;
(function (EnumToLowerCase) {
    EnumToLowerCase[EnumToLowerCase["toLowerCase"] = 1] = "toLowerCase";
    EnumToLowerCase[EnumToLowerCase["toLocaleLowerCase"] = 2] = "toLocaleLowerCase";
})(EnumToLowerCase = exports.EnumToLowerCase || (exports.EnumToLowerCase = {}));
/**
 * create a compare callback by (transpileBase value) -> trigger(transpile value) -> failbackSort
 * @param options
 */
function createSortCallback(options = {}) {
    const r = options.dotNum ? /^(\d+(?:\.\d+)?)/ : /^(\d+)/;
    const failbackSort = options.failbackSort || naturalCompare;
    const trigger = options.trigger || _match;
    let transpile = options.transpile || _trim;
    let transpileBase = options.transpileBase;
    if (options.toLowerCase) {
        let fnLowerCase;
        if (typeof options.toLowerCase === 'function') {
            fnLowerCase = options.toLowerCase;
        }
        else {
            let fn = 'toLowerCase';
            if (typeof options.toLowerCase === 'number') {
                if (options.toLowerCase !== EnumToLowerCase.toLowerCase) {
                    fn = 'toLocaleLowerCase';
                }
            }
            fnLowerCase = (input, ...argv) => input[fn](...argv);
        }
        if (fnLowerCase) {
            if (transpileBase) {
                transpileBase = ((old) => {
                    return function (input, ...argv) {
                        return fnLowerCase(old(input, ...argv), ...argv);
                    };
                })(transpileBase);
            }
            else {
                transpileBase = fnLowerCase;
            }
        }
    }
    let fnSortCallback = function fnSortCallback(a, b, isSub) {
        if (a === b) {
            return 0;
        }
        let ret = trigger(transpile(a, isSub), transpile(b, isSub), {
            r,
            mainFn: fnSortCallback,
            isSub,
        });
        return (typeof ret == 'number') ? ret : failbackSort(a, b);
    };
    if (transpileBase) {
        fnSortCallback = (function (oldFn) {
            return function (a, b, isSub) {
                if (a === b) {
                    return 0;
                }
                if (isSub) {
                    return oldFn(a, b, isSub);
                }
                return oldFn(transpileBase(a), transpileBase(b), isSub);
            };
        })(fnSortCallback);
    }
    else {
        transpileBase = (input) => input;
    }
    fnSortCallback.failbackSort = failbackSort;
    fnSortCallback.trigger = trigger;
    fnSortCallback.transpile = transpile;
    fnSortCallback.transpileBase = transpileBase;
    fnSortCallback.fnSortCallback = fnSortCallback;
    return fnSortCallback;
}
exports.createSortCallback = createSortCallback;
exports.defaultSortCallback = createSortCallback({
    dotNum: true,
});
exports.default = exports.defaultSortCallback;
function _match(a, b, { r, mainFn, }) {
    let ta;
    let tb;
    if ((ta = r.exec(a)) && (tb = r.exec(b))) {
        let r = parseInt(ta[0]) - parseInt(tb[0]);
        if (r !== 0) {
            return r;
        }
        let a1 = ta.input.slice(ta[0].length);
        let b1 = tb.input.slice(tb[0].length);
        if (a1 != b1) {
            let i = 0;
            while (typeof a1[i] != 'undefined' && a1[i] == b1[i] && (!/^\d$/.test(b1[0]))) {
                i++;
            }
            a1 = a1.slice(i);
            b1 = b1.slice(i);
        }
        return mainFn(a1, b1, true);
    }
}
exports._match = _match;
function _trim(input) {
    return input
        .replace(/^[_\s]+(\d+)/, '$1')
        .replace(/^\D(\d+)/, '$1')
        .trim();
}
exports._trim = _trim;
// @ts-ignore
exports = Object.freeze(exports);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgseURBQXlEO0FBMkpoRCx3Q0FBYztBQXpKdkIsSUFBWSxlQUlYO0FBSkQsV0FBWSxlQUFlO0lBRTFCLG1FQUFlLENBQUE7SUFDZiwrRUFBcUIsQ0FBQTtBQUN0QixDQUFDLEVBSlcsZUFBZSxHQUFmLHVCQUFlLEtBQWYsdUJBQWUsUUFJMUI7QUE2Q0Q7OztHQUdHO0FBQ0gsU0FBZ0Isa0JBQWtCLENBQUMsVUFBc0MsRUFBRTtJQUUxRSxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBRXpELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLElBQUksY0FBYyxDQUFDO0lBQzVELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDO0lBQzFDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLElBQUksS0FBSyxDQUFDO0lBQzNDLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFFMUMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUN2QjtRQUNDLElBQUksV0FBK0MsQ0FBQztRQUVwRCxJQUFJLE9BQU8sT0FBTyxDQUFDLFdBQVcsS0FBSyxVQUFVLEVBQzdDO1lBQ0MsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7U0FDbEM7YUFFRDtZQUNDLElBQUksRUFBRSxHQUFHLGFBQWEsQ0FBQztZQUV2QixJQUFJLE9BQU8sT0FBTyxDQUFDLFdBQVcsS0FBSyxRQUFRLEVBQzNDO2dCQUNDLElBQUksT0FBTyxDQUFDLFdBQVcsS0FBSyxlQUFlLENBQUMsV0FBVyxFQUN2RDtvQkFDQyxFQUFFLEdBQUcsbUJBQW1CLENBQUM7aUJBQ3pCO2FBQ0Q7WUFFRCxXQUFXLEdBQUcs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QztTQUN6QixJQUFJLEVBQUUsQ0FDTjtBQUNILENBQUM7QUFQRCxzQkFPQztBQUVELGFBQWE7QUFDYixPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvMi8xMi8wMTIuXG4gKi9cblxuaW1wb3J0ICogYXMgbmF0dXJhbENvbXBhcmUgZnJvbSAnc3RyaW5nLW5hdHVyYWwtY29tcGFyZSc7XG5cbmV4cG9ydCBlbnVtIEVudW1Ub0xvd2VyQ2FzZVxue1xuXHR0b0xvd2VyQ2FzZSA9IDEsXG5cdHRvTG9jYWxlTG93ZXJDYXNlID0gMixcbn1cblxuZXhwb3J0IGRlY2xhcmUgZnVuY3Rpb24gZGVmYXVsdFNvcnRDYWxsYmFjayhhOiBzdHJpbmcsIGI6IHN0cmluZywgaXNTdWI/OiBib29sZWFuKTogbnVtYmVyO1xuZXhwb3J0IGRlY2xhcmUgbmFtZXNwYWNlIGRlZmF1bHRTb3J0Q2FsbGJhY2tcbntcblx0ZXhwb3J0IGZ1bmN0aW9uIGZhaWxiYWNrU29ydChhLCBiKTogbnVtYmVyXG5cdGV4cG9ydCBmdW5jdGlvbiB0cmlnZ2VyKGE6IHN0cmluZywgYjogc3RyaW5nLCBkYXRhOiBJVHJpZ2dlckRhdGEpOiBudW1iZXJcblx0ZXhwb3J0IGZ1bmN0aW9uIHRyYW5zcGlsZShpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nXG5cdGV4cG9ydCBmdW5jdGlvbiB0cmFuc3BpbGVCYXNlKGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpOiBzdHJpbmdcblxuXHRleHBvcnQgZnVuY3Rpb24gZm5Tb3J0Q2FsbGJhY2soYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBJRm5Tb3J0Q2FsbGJhY2sgPSB0eXBlb2YgZGVmYXVsdFNvcnRDYWxsYmFjaztcblxuZXhwb3J0IHR5cGUgSUNyZWF0ZVNvcnRDYWxsYmFja09wdGlvbnMgPSB7XG5cdGRvdE51bT86IGJvb2xlYW4sXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBiYXNlIGlucHV0IHZhbHVlXG5cdCAqL1xuXHR0b0xvd2VyQ2FzZT86IEVudW1Ub0xvd2VyQ2FzZSB8IGJvb2xlYW4gfCAoKGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpID0+IHN0cmluZyksXG59ICYgSUZuU29ydENhbGxiYWNrUHJvcDtcblxuZXhwb3J0IGludGVyZmFjZSBJRm5Tb3J0Q2FsbGJhY2tQcm9wXG57XG5cdC8qKlxuXHQgKiBmYWlsYmFjayBjb21wYXJlXG5cdCAqL1xuXHRmYWlsYmFja1NvcnQ/KGEsIGIpOiBudW1iZXIsXG5cblx0LyoqXG5cdCAqIGNvbXBhcmUgdHJhbnNwaWxlIHZhbHVlXG5cdCAqL1xuXHR0cmlnZ2VyPyhhOiBzdHJpbmcsIGI6IHN0cmluZywgZGF0YTogSVRyaWdnZXJEYXRhKTogbnVtYmVyLFxuXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBpbnB1dCB2YWx1ZSBmb3IgdHJpZ2dlciBvbmx5XG5cdCAqL1xuXHR0cmFuc3BpbGU/KGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpOiBzdHJpbmcsXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBiYXNlIGlucHV0IHZhbHVlXG5cdCAqL1xuXHR0cmFuc3BpbGVCYXNlPyhpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nLFxufVxuXG4vKipcbiAqIGNyZWF0ZSBhIGNvbXBhcmUgY2FsbGJhY2sgYnkgKHRyYW5zcGlsZUJhc2UgdmFsdWUpIC0+IHRyaWdnZXIodHJhbnNwaWxlIHZhbHVlKSAtPiBmYWlsYmFja1NvcnRcbiAqIEBwYXJhbSBvcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTb3J0Q2FsbGJhY2sob3B0aW9uczogSUNyZWF0ZVNvcnRDYWxsYmFja09wdGlvbnMgPSB7fSk6IElGblNvcnRDYWxsYmFja1xue1xuXHRjb25zdCByID0gb3B0aW9ucy5kb3ROdW0gPyAvXihcXGQrKD86XFwuXFxkKyk/KS8gOiAvXihcXGQrKS87XG5cblx0Y29uc3QgZmFpbGJhY2tTb3J0ID0gb3B0aW9ucy5mYWlsYmFja1NvcnQgfHwgbmF0dXJhbENvbXBhcmU7XG5cdGNvbnN0IHRyaWdnZXIgPSBvcHRpb25zLnRyaWdnZXIgfHwgX21hdGNoO1xuXHRsZXQgdHJhbnNwaWxlID0gb3B0aW9ucy50cmFuc3BpbGUgfHwgX3RyaW07XG5cdGxldCB0cmFuc3BpbGVCYXNlID0gb3B0aW9ucy50cmFuc3BpbGVCYXNlO1xuXG5cdGlmIChvcHRpb25zLnRvTG93ZXJDYXNlKVxuXHR7XG5cdFx0bGV0IGZuTG93ZXJDYXNlOiAoaW5wdXQ6IHN0cmluZywgLi4uYXJndikgPT4gc3RyaW5nO1xuXG5cdFx0aWYgKHR5cGVvZiBvcHRpb25zLnRvTG93ZXJDYXNlID09PSAnZnVuY3Rpb24nKVxuXHRcdHtcblx0XHRcdGZuTG93ZXJDYXNlID0gb3B0aW9ucy50b0xvd2VyQ2FzZTtcblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdGxldCBmbiA9ICd0b0xvd2VyQ2FzZSc7XG5cblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy50b0xvd2VyQ2FzZSA9PT0gJ251bWJlcicpXG5cdFx0XHR7XG5cdFx0XHRcdGlmIChvcHRpb25zLnRvTG93ZXJDYXNlICE9PSBFbnVtVG9Mb3dlckNhc2UudG9Mb3dlckNhc2UpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRmbiA9ICd0b0xvY2FsZUxvd2VyQ2FzZSc7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Zm5Mb3dlckNhc2UgPSAoaW5wdXQ6IHN0cmluZywgLi4uYXJndikgPT4gaW5wdXRbZm5dKC4uLmFyZ3YpO1xuXHRcdH1cblxuXHRcdGlmIChmbkxvd2VyQ2FzZSlcblx0XHR7XG5cdFx0XHRpZiAodHJhbnNwaWxlQmFzZSlcblx0XHRcdHtcblx0XHRcdFx0dHJhbnNwaWxlQmFzZSA9ICgob2xkKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgLi4uYXJndilcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZm5Mb3dlckNhc2Uob2xkKGlucHV0LCAuLi5hcmd2KSwgLi4uYXJndilcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pKHRyYW5zcGlsZUJhc2UpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR0cmFuc3BpbGVCYXNlID0gZm5Mb3dlckNhc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bGV0IGZuU29ydENhbGxiYWNrOiBJRm5Tb3J0Q2FsbGJhY2sgPSBmdW5jdGlvbiBmblNvcnRDYWxsYmFjayhhOiBzdHJpbmcsIGI6IHN0cmluZywgaXNTdWI/OiBib29sZWFuKTogbnVtYmVyXG5cdHtcblx0XHRpZiAoYSA9PT0gYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cblx0XHRsZXQgcmV0ID0gdHJpZ2dlcih0cmFuc3BpbGUoYSwgaXNTdWIpLCB0cmFuc3BpbGUoYiwgaXNTdWIpLCB7XG5cdFx0XHRyLFxuXHRcdFx0bWFpbkZuOiBmblNvcnRDYWxsYmFjayBhcyBJRm5Tb3J0Q2FsbGJhY2ssXG5cdFx0XHRpc1N1Yixcblx0XHR9KTtcblxuXHRcdHJldHVybiAodHlwZW9mIHJldCA9PSAnbnVtYmVyJykgPyByZXQgOiBmYWlsYmFja1NvcnQoYSwgYik7XG5cdH0gYXMgSUZuU29ydENhbGxiYWNrO1xuXG5cdGlmICh0cmFuc3BpbGVCYXNlKVxuXHR7XG5cdFx0Zm5Tb3J0Q2FsbGJhY2sgPSAoZnVuY3Rpb24gKG9sZEZuKVxuXHRcdHtcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlclxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoYSA9PT0gYilcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGlzU3ViKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cmV0dXJuIG9sZEZuKGEsIGIsIGlzU3ViKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBvbGRGbih0cmFuc3BpbGVCYXNlKGEpLCB0cmFuc3BpbGVCYXNlKGIpLCBpc1N1Yik7XG5cdFx0XHR9IGFzIElGblNvcnRDYWxsYmFja1xuXHRcdH0pKGZuU29ydENhbGxiYWNrKTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHR0cmFuc3BpbGVCYXNlID0gKGlucHV0OiBzdHJpbmcpID0+IGlucHV0O1xuXHR9XG5cblx0Zm5Tb3J0Q2FsbGJhY2suZmFpbGJhY2tTb3J0ID0gZmFpbGJhY2tTb3J0O1xuXHRmblNvcnRDYWxsYmFjay50cmlnZ2VyID0gdHJpZ2dlcjtcblx0Zm5Tb3J0Q2FsbGJhY2sudHJhbnNwaWxlID0gdHJhbnNwaWxlO1xuXHRmblNvcnRDYWxsYmFjay50cmFuc3BpbGVCYXNlID0gdHJhbnNwaWxlQmFzZTtcblx0Zm5Tb3J0Q2FsbGJhY2suZm5Tb3J0Q2FsbGJhY2sgPSBmblNvcnRDYWxsYmFjaztcblxuXHRyZXR1cm4gZm5Tb3J0Q2FsbGJhY2s7XG59XG5cbmV4cG9ydCB7IG5hdHVyYWxDb21wYXJlIH1cblxuZXhwb3J0cy5kZWZhdWx0U29ydENhbGxiYWNrID0gY3JlYXRlU29ydENhbGxiYWNrKHtcblx0ZG90TnVtOiB0cnVlLFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMuZGVmYXVsdFNvcnRDYWxsYmFjayBhcyB0eXBlb2YgZGVmYXVsdFNvcnRDYWxsYmFja1xuXG5leHBvcnQgaW50ZXJmYWNlIElUcmlnZ2VyRGF0YVxue1xuXHRyOiBSZWdFeHAsXG5cdG1haW5GbjogSUZuU29ydENhbGxiYWNrLFxuXHRpc1N1YjogYm9vbGVhbixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9tYXRjaChhOiBzdHJpbmcsIGI6IHN0cmluZywge1xuXHRyLFxuXHRtYWluRm4sXG59OiBJVHJpZ2dlckRhdGEpXG57XG5cdGxldCB0YTogUmVnRXhwRXhlY0FycmF5O1xuXHRsZXQgdGI6IFJlZ0V4cEV4ZWNBcnJheTtcblxuXHRpZiAoKHRhID0gci5leGVjKGEpKSAmJiAodGIgPSByLmV4ZWMoYikpKVxuXHR7XG5cdFx0bGV0IHIgPSBwYXJzZUludCh0YVswXSkgLSBwYXJzZUludCh0YlswXSk7XG5cblx0XHRpZiAociAhPT0gMClcblx0XHR7XG5cdFx0XHRyZXR1cm4gcjtcblx0XHR9XG5cblx0XHRsZXQgYTEgPSB0YS5pbnB1dC5zbGljZSh0YVswXS5sZW5ndGgpO1xuXHRcdGxldCBiMSA9IHRiLmlucHV0LnNsaWNlKHRiWzBdLmxlbmd0aCk7XG5cblx0XHRpZiAoYTEgIT0gYjEpXG5cdFx0e1xuXHRcdFx0bGV0IGkgPSAwO1xuXG5cdFx0XHR3aGlsZSAodHlwZW9mIGExW2ldICE9ICd1bmRlZmluZWQnICYmIGExW2ldID09IGIxW2ldICYmICghL15cXGQkLy50ZXN0KGIxWzBdKSkpXG5cdFx0XHR7XG5cdFx0XHRcdGkrKztcblx0XHRcdH1cblxuXHRcdFx0YTEgPSBhMS5zbGljZShpKTtcblx0XHRcdGIxID0gYjEuc2xpY2UoaSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1haW5GbihhMSwgYjEsIHRydWUpO1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfdHJpbShpbnB1dDogc3RyaW5nKTogc3RyaW5nXG57XG5cdHJldHVybiBpbnB1dFxuXHRcdC5yZXBsYWNlKC9eW19cXHNdKyhcXGQrKS8sICckMScpXG5cdFx0LnJlcGxhY2UoL15cXEQoXFxkKykvLCAnJDEnKVxuXHRcdC50cmltKClcblx0XHQ7XG59XG5cbi8vIEB0cy1pZ25vcmVcbmV4cG9ydHMgPSBPYmplY3QuZnJlZXplKGV4cG9ydHMpO1xuIl19