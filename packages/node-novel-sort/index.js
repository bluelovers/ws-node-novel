"use strict";
/**
 * Created by user on 2018/2/12/012.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const string_natural_compare_1 = __importDefault(require("string-natural-compare"));
exports.naturalCompare = string_natural_compare_1.default;
var EnumToLowerCase;
(function (EnumToLowerCase) {
    EnumToLowerCase[EnumToLowerCase["toLowerCase"] = 1] = "toLowerCase";
    EnumToLowerCase[EnumToLowerCase["toLocaleLowerCase"] = 2] = "toLocaleLowerCase";
})(EnumToLowerCase = exports.EnumToLowerCase || (exports.EnumToLowerCase = {}));
/**
 * create a compare callback by (transpileBase value) -> trigger(transpile value) -> failbackSort
 * @param options
 */
function createSortCallback(options = {}) {
    const r = options.dotNum ? /^(\d+(?:\.\d+)?)/ : /^(\d+)/;
    const failbackSort = options.failbackSort || string_natural_compare_1.default;
    const trigger = options.trigger || _match;
    let transpile = options.transpile || _trim;
    let transpileBase = options.transpileBase;
    if (options.toLowerCase) {
        let fnLowerCase;
        if (typeof options.toLowerCase === 'function') {
            fnLowerCase = options.toLowerCase;
        }
        else {
            let fn = 'toLowerCase';
            if (typeof options.toLowerCase === 'number') {
                if (options.toLowerCase !== EnumToLowerCase.toLowerCase) {
                    fn = 'toLocaleLowerCase';
                }
            }
            fnLowerCase = (input, ...argv) => input[fn](...argv);
        }
        if (fnLowerCase) {
            if (transpileBase) {
                transpileBase = ((old) => {
                    return function (input, ...argv) {
                        return fnLowerCase(old(input, ...argv), ...argv);
                    };
                })(transpileBase);
            }
            else {
                transpileBase = fnLowerCase;
            }
        }
    }
    let fnSortCallback = function fnSortCallback(a, b, isSub) {
        if (a === b) {
            return 0;
        }
        let ret = trigger(transpile(a, isSub), transpile(b, isSub), {
            r,
            mainFn: fnSortCallback,
            isSub,
        });
        return (typeof ret == 'number') ? ret : failbackSort(a, b);
    };
    if (transpileBase) {
        fnSortCallback = (function (oldFn) {
            return function (a, b, isSub) {
                if (a === b) {
                    return 0;
                }
                if (isSub) {
                    return oldFn(a, b, isSub);
                }
                return oldFn(transpileBase(a), transpileBase(b), isSub);
            };
        })(fnSortCallback);
    }
    else {
        transpileBase = (input) => input;
    }
    fnSortCallback.failbackSort = failbackSort;
    fnSortCallback.trigger = trigger;
    fnSortCallback.transpile = transpile;
    fnSortCallback.transpileBase = transpileBase;
    fnSortCallback.fnSortCallback = fnSortCallback;
    return fnSortCallback;
}
exports.createSortCallback = createSortCallback;
exports.defaultSortCallback = createSortCallback({
    dotNum: true,
});
exports.default = exports.defaultSortCallback;
function _match(a, b, { r, mainFn, }) {
    let ta;
    let tb;
    if ((ta = r.exec(a)) && (tb = r.exec(b))) {
        let r = parseFloat(ta[0]) - parseFloat(tb[0]);
        if (r !== 0) {
            return r;
        }
        let a1 = ta.input.slice(ta[0].length);
        let b1 = tb.input.slice(tb[0].length);
        if (a1 != b1) {
            let i = 0;
            while (typeof a1[i] != 'undefined' && a1[i] === b1[i] && (!/^\d$/.test(b1[i]))) {
                i++;
            }
            a1 = a1.slice(i);
            b1 = b1.slice(i);
        }
        return mainFn(a1, b1, true);
    }
}
exports._match = _match;
function _trim(input) {
    return input
        .replace(/^[_\s]+(\d+)/, '$1')
        .replace(/^\D(\d+)/, '$1')
        .trim();
}
exports._trim = _trim;
// @ts-ignore
exports = Object.freeze(exports);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7Ozs7O0FBRUgsb0ZBQW9EO0FBMkozQyx5QkEzSkYsZ0NBQWMsQ0EySkU7QUF6SnZCLElBQVksZUFJWDtBQUpELFdBQVksZUFBZTtJQUUxQixtRUFBZSxDQUFBO0lBQ2YsK0VBQXFCLENBQUE7QUFDdEIsQ0FBQyxFQUpXLGVBQWUsR0FBZix1QkFBZSxLQUFmLHVCQUFlLFFBSTFCO0FBNkNEOzs7R0FHRztBQUNILFNBQWdCLGtCQUFrQixDQUFDLFVBQXNDLEVBQUU7SUFFMUUsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztJQUV6RCxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLGdDQUFjLENBQUM7SUFDNUQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sSUFBSSxNQUFNLENBQUM7SUFDMUMsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUM7SUFDM0MsSUFBSSxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQztJQUUxQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQ3ZCO1FBQ0MsSUFBSSxXQUErQyxDQUFDO1FBRXBELElBQUksT0FBTyxPQUFPLENBQUMsV0FBVyxLQUFLLFVBQVUsRUFDN0M7WUFDQyxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztTQUNsQzthQUVEO1lBQ0MsSUFBSSxFQUFFLEdBQUcsYUFBYSxDQUFDO1lBRXZCLElBQUksT0FBTyxPQUFPLENBQUMsV0FBVyxLQUFLLFFBQVEsRUFDM0M7Z0JBQ0MsSUFBSSxPQUFPLENBQUMsV0FBVyxLQUFLLGVBQWUsQ0FBQyxXQUFXLEVBQ3ZEO29CQUNDLEVBQUUsR0FBRyxtQkFBbUIsQ0FBQztpQkFDekI7YUFD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QUFVLEVBQUUsSUFBSSxDQUFDO1NBQ3pCLElBQUksRUFBRSxDQUNOO0FBQ0gsQ0FBQztBQVBELHNCQU9DO0FBRUQsYUFBYTtBQUNiLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOC8yLzEyLzAxMi5cbiAqL1xuXG5pbXBvcnQgbmF0dXJhbENvbXBhcmUgZnJvbSAnc3RyaW5nLW5hdHVyYWwtY29tcGFyZSc7XG5cbmV4cG9ydCBlbnVtIEVudW1Ub0xvd2VyQ2FzZVxue1xuXHR0b0xvd2VyQ2FzZSA9IDEsXG5cdHRvTG9jYWxlTG93ZXJDYXNlID0gMixcbn1cblxuZXhwb3J0IGRlY2xhcmUgZnVuY3Rpb24gZGVmYXVsdFNvcnRDYWxsYmFjayhhOiBzdHJpbmcsIGI6IHN0cmluZywgaXNTdWI/OiBib29sZWFuKTogbnVtYmVyO1xuZXhwb3J0IGRlY2xhcmUgbmFtZXNwYWNlIGRlZmF1bHRTb3J0Q2FsbGJhY2tcbntcblx0ZXhwb3J0IGZ1bmN0aW9uIGZhaWxiYWNrU29ydChhLCBiKTogbnVtYmVyXG5cdGV4cG9ydCBmdW5jdGlvbiB0cmlnZ2VyKGE6IHN0cmluZywgYjogc3RyaW5nLCBkYXRhOiBJVHJpZ2dlckRhdGEpOiBudW1iZXJcblx0ZXhwb3J0IGZ1bmN0aW9uIHRyYW5zcGlsZShpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nXG5cdGV4cG9ydCBmdW5jdGlvbiB0cmFuc3BpbGVCYXNlKGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpOiBzdHJpbmdcblxuXHRleHBvcnQgZnVuY3Rpb24gZm5Tb3J0Q2FsbGJhY2soYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlclxufVxuXG5leHBvcnQgdHlwZSBJRm5Tb3J0Q2FsbGJhY2sgPSB0eXBlb2YgZGVmYXVsdFNvcnRDYWxsYmFjaztcblxuZXhwb3J0IHR5cGUgSUNyZWF0ZVNvcnRDYWxsYmFja09wdGlvbnMgPSB7XG5cdGRvdE51bT86IGJvb2xlYW4sXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBiYXNlIGlucHV0IHZhbHVlXG5cdCAqL1xuXHR0b0xvd2VyQ2FzZT86IEVudW1Ub0xvd2VyQ2FzZSB8IGJvb2xlYW4gfCAoKGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpID0+IHN0cmluZyksXG59ICYgSUZuU29ydENhbGxiYWNrUHJvcDtcblxuZXhwb3J0IGludGVyZmFjZSBJRm5Tb3J0Q2FsbGJhY2tQcm9wXG57XG5cdC8qKlxuXHQgKiBmYWlsYmFjayBjb21wYXJlXG5cdCAqL1xuXHRmYWlsYmFja1NvcnQ/KGEsIGIpOiBudW1iZXIsXG5cblx0LyoqXG5cdCAqIGNvbXBhcmUgdHJhbnNwaWxlIHZhbHVlXG5cdCAqL1xuXHR0cmlnZ2VyPyhhOiBzdHJpbmcsIGI6IHN0cmluZywgZGF0YTogSVRyaWdnZXJEYXRhKTogbnVtYmVyLFxuXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBpbnB1dCB2YWx1ZSBmb3IgdHJpZ2dlciBvbmx5XG5cdCAqL1xuXHR0cmFuc3BpbGU/KGlucHV0LCBpc1N1Yj8sIC4uLmFyZ3YpOiBzdHJpbmcsXG5cdC8qKlxuXHQgKiB3aWxsIGNoYW5nZSBiYXNlIGlucHV0IHZhbHVlXG5cdCAqL1xuXHR0cmFuc3BpbGVCYXNlPyhpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nLFxufVxuXG4vKipcbiAqIGNyZWF0ZSBhIGNvbXBhcmUgY2FsbGJhY2sgYnkgKHRyYW5zcGlsZUJhc2UgdmFsdWUpIC0+IHRyaWdnZXIodHJhbnNwaWxlIHZhbHVlKSAtPiBmYWlsYmFja1NvcnRcbiAqIEBwYXJhbSBvcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTb3J0Q2FsbGJhY2sob3B0aW9uczogSUNyZWF0ZVNvcnRDYWxsYmFja09wdGlvbnMgPSB7fSk6IElGblNvcnRDYWxsYmFja1xue1xuXHRjb25zdCByID0gb3B0aW9ucy5kb3ROdW0gPyAvXihcXGQrKD86XFwuXFxkKyk/KS8gOiAvXihcXGQrKS87XG5cblx0Y29uc3QgZmFpbGJhY2tTb3J0ID0gb3B0aW9ucy5mYWlsYmFja1NvcnQgfHwgbmF0dXJhbENvbXBhcmU7XG5cdGNvbnN0IHRyaWdnZXIgPSBvcHRpb25zLnRyaWdnZXIgfHwgX21hdGNoO1xuXHRsZXQgdHJhbnNwaWxlID0gb3B0aW9ucy50cmFuc3BpbGUgfHwgX3RyaW07XG5cdGxldCB0cmFuc3BpbGVCYXNlID0gb3B0aW9ucy50cmFuc3BpbGVCYXNlO1xuXG5cdGlmIChvcHRpb25zLnRvTG93ZXJDYXNlKVxuXHR7XG5cdFx0bGV0IGZuTG93ZXJDYXNlOiAoaW5wdXQ6IHN0cmluZywgLi4uYXJndikgPT4gc3RyaW5nO1xuXG5cdFx0aWYgKHR5cGVvZiBvcHRpb25zLnRvTG93ZXJDYXNlID09PSAnZnVuY3Rpb24nKVxuXHRcdHtcblx0XHRcdGZuTG93ZXJDYXNlID0gb3B0aW9ucy50b0xvd2VyQ2FzZTtcblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdGxldCBmbiA9ICd0b0xvd2VyQ2FzZSc7XG5cblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9ucy50b0xvd2VyQ2FzZSA9PT0gJ251bWJlcicpXG5cdFx0XHR7XG5cdFx0XHRcdGlmIChvcHRpb25zLnRvTG93ZXJDYXNlICE9PSBFbnVtVG9Mb3dlckNhc2UudG9Mb3dlckNhc2UpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRmbiA9ICd0b0xvY2FsZUxvd2VyQ2FzZSc7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Zm5Mb3dlckNhc2UgPSAoaW5wdXQ6IHN0cmluZywgLi4uYXJndikgPT4gaW5wdXRbZm5dKC4uLmFyZ3YpO1xuXHRcdH1cblxuXHRcdGlmIChmbkxvd2VyQ2FzZSlcblx0XHR7XG5cdFx0XHRpZiAodHJhbnNwaWxlQmFzZSlcblx0XHRcdHtcblx0XHRcdFx0dHJhbnNwaWxlQmFzZSA9ICgob2xkKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgLi4uYXJndilcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZm5Mb3dlckNhc2Uob2xkKGlucHV0LCAuLi5hcmd2KSwgLi4uYXJndilcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pKHRyYW5zcGlsZUJhc2UpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0e1xuXHRcdFx0XHR0cmFuc3BpbGVCYXNlID0gZm5Mb3dlckNhc2U7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bGV0IGZuU29ydENhbGxiYWNrOiBJRm5Tb3J0Q2FsbGJhY2sgPSBmdW5jdGlvbiBmblNvcnRDYWxsYmFjayhhOiBzdHJpbmcsIGI6IHN0cmluZywgaXNTdWI/OiBib29sZWFuKTogbnVtYmVyXG5cdHtcblx0XHRpZiAoYSA9PT0gYilcblx0XHR7XG5cdFx0XHRyZXR1cm4gMDtcblx0XHR9XG5cblx0XHRsZXQgcmV0ID0gdHJpZ2dlcih0cmFuc3BpbGUoYSwgaXNTdWIpLCB0cmFuc3BpbGUoYiwgaXNTdWIpLCB7XG5cdFx0XHRyLFxuXHRcdFx0bWFpbkZuOiBmblNvcnRDYWxsYmFjayBhcyBJRm5Tb3J0Q2FsbGJhY2ssXG5cdFx0XHRpc1N1Yixcblx0XHR9KTtcblxuXHRcdHJldHVybiAodHlwZW9mIHJldCA9PSAnbnVtYmVyJykgPyByZXQgOiBmYWlsYmFja1NvcnQoYSwgYik7XG5cdH0gYXMgSUZuU29ydENhbGxiYWNrO1xuXG5cdGlmICh0cmFuc3BpbGVCYXNlKVxuXHR7XG5cdFx0Zm5Tb3J0Q2FsbGJhY2sgPSAoZnVuY3Rpb24gKG9sZEZuKVxuXHRcdHtcblx0XHRcdHJldHVybiBmdW5jdGlvbiAoYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlclxuXHRcdFx0e1xuXHRcdFx0XHRpZiAoYSA9PT0gYilcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGlzU3ViKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0cmV0dXJuIG9sZEZuKGEsIGIsIGlzU3ViKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiBvbGRGbih0cmFuc3BpbGVCYXNlKGEpLCB0cmFuc3BpbGVCYXNlKGIpLCBpc1N1Yik7XG5cdFx0XHR9IGFzIElGblNvcnRDYWxsYmFja1xuXHRcdH0pKGZuU29ydENhbGxiYWNrKTtcblx0fVxuXHRlbHNlXG5cdHtcblx0XHR0cmFuc3BpbGVCYXNlID0gKGlucHV0OiBzdHJpbmcpID0+IGlucHV0O1xuXHR9XG5cblx0Zm5Tb3J0Q2FsbGJhY2suZmFpbGJhY2tTb3J0ID0gZmFpbGJhY2tTb3J0O1xuXHRmblNvcnRDYWxsYmFjay50cmlnZ2VyID0gdHJpZ2dlcjtcblx0Zm5Tb3J0Q2FsbGJhY2sudHJhbnNwaWxlID0gdHJhbnNwaWxlO1xuXHRmblNvcnRDYWxsYmFjay50cmFuc3BpbGVCYXNlID0gdHJhbnNwaWxlQmFzZTtcblx0Zm5Tb3J0Q2FsbGJhY2suZm5Tb3J0Q2FsbGJhY2sgPSBmblNvcnRDYWxsYmFjaztcblxuXHRyZXR1cm4gZm5Tb3J0Q2FsbGJhY2s7XG59XG5cbmV4cG9ydCB7IG5hdHVyYWxDb21wYXJlIH1cblxuZXhwb3J0cy5kZWZhdWx0U29ydENhbGxiYWNrID0gY3JlYXRlU29ydENhbGxiYWNrKHtcblx0ZG90TnVtOiB0cnVlLFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMuZGVmYXVsdFNvcnRDYWxsYmFjayBhcyB0eXBlb2YgZGVmYXVsdFNvcnRDYWxsYmFja1xuXG5leHBvcnQgaW50ZXJmYWNlIElUcmlnZ2VyRGF0YVxue1xuXHRyOiBSZWdFeHAsXG5cdG1haW5GbjogSUZuU29ydENhbGxiYWNrLFxuXHRpc1N1YjogYm9vbGVhbixcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9tYXRjaChhOiBzdHJpbmcsIGI6IHN0cmluZywge1xuXHRyLFxuXHRtYWluRm4sXG59OiBJVHJpZ2dlckRhdGEpXG57XG5cdGxldCB0YTogUmVnRXhwRXhlY0FycmF5O1xuXHRsZXQgdGI6IFJlZ0V4cEV4ZWNBcnJheTtcblxuXHRpZiAoKHRhID0gci5leGVjKGEpKSAmJiAodGIgPSByLmV4ZWMoYikpKVxuXHR7XG5cdFx0bGV0IHIgPSBwYXJzZUZsb2F0KHRhWzBdKSAtIHBhcnNlRmxvYXQodGJbMF0pO1xuXG5cdFx0aWYgKHIgIT09IDApXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHI7XG5cdFx0fVxuXG5cdFx0bGV0IGExID0gdGEuaW5wdXQuc2xpY2UodGFbMF0ubGVuZ3RoKTtcblx0XHRsZXQgYjEgPSB0Yi5pbnB1dC5zbGljZSh0YlswXS5sZW5ndGgpO1xuXG5cdFx0aWYgKGExICE9IGIxKVxuXHRcdHtcblx0XHRcdGxldCBpID0gMDtcblxuXHRcdFx0d2hpbGUgKHR5cGVvZiBhMVtpXSAhPSAndW5kZWZpbmVkJyAmJiBhMVtpXSA9PT0gYjFbaV0gJiYgKCEvXlxcZCQvLnRlc3QoYjFbaV0pKSlcblx0XHRcdHtcblx0XHRcdFx0aSsrO1xuXHRcdFx0fVxuXG5cdFx0XHRhMSA9IGExLnNsaWNlKGkpO1xuXHRcdFx0YjEgPSBiMS5zbGljZShpKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gbWFpbkZuKGExLCBiMSwgdHJ1ZSk7XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF90cmltKGlucHV0OiBzdHJpbmcpOiBzdHJpbmdcbntcblx0cmV0dXJuIGlucHV0XG5cdFx0LnJlcGxhY2UoL15bX1xcc10rKFxcZCspLywgJyQxJylcblx0XHQucmVwbGFjZSgvXlxcRChcXGQrKS8sICckMScpXG5cdFx0LnRyaW0oKVxuXHRcdDtcbn1cblxuLy8gQHRzLWlnbm9yZVxuZXhwb3J0cyA9IE9iamVjdC5mcmVlemUoZXhwb3J0cyk7XG4iXX0=