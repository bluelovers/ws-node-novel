"use strict";
/**
 * Created by user on 2018/2/12/012.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const naturalCompare = require("string-natural-compare");
exports.naturalCompare = naturalCompare;
var EnumToLowerCase;
(function (EnumToLowerCase) {
    EnumToLowerCase[EnumToLowerCase["toLowerCase"] = 1] = "toLowerCase";
    EnumToLowerCase[EnumToLowerCase["toLocaleLowerCase"] = 2] = "toLocaleLowerCase";
})(EnumToLowerCase = exports.EnumToLowerCase || (exports.EnumToLowerCase = {}));
/**
 * create a compare callback by (transpileBase value) -> trigger(transpile value) -> failbackSort
 * @param options
 */
function createSortCallback(options = {}) {
    const r = options.dotNum ? /^(\d+(?:\.\d+)?)/ : /^(\d+)/;
    const failbackSort = options.failbackSort || naturalCompare;
    const trigger = options.trigger || _match;
    let transpile = options.transpile || _trim;
    let transpileBase = options.transpileBase;
    if (options.toLowerCase) {
        let fnLowerCase;
        if (typeof options.toLowerCase === 'function') {
            fnLowerCase = options.toLowerCase;
        }
        else {
            let fn = 'toLowerCase';
            if (typeof options.toLowerCase === 'number') {
                if (options.toLowerCase !== EnumToLowerCase.toLowerCase) {
                    fn = 'toLocaleLowerCase';
                }
            }
            fnLowerCase = (input, ...argv) => input[fn](...argv);
        }
        if (fnLowerCase) {
            if (transpileBase) {
                transpileBase = ((old) => {
                    return function (input, ...argv) {
                        return fnLowerCase(old(input, ...argv), ...argv);
                    };
                })(transpileBase);
            }
            else {
                transpileBase = fnLowerCase;
            }
        }
    }
    let fnSortCallback = function fnSortCallback(a, b, isSub) {
        if (a === b) {
            return 0;
        }
        let ret = trigger(transpile(a, isSub), transpile(b, isSub), {
            r,
            mainFn: fnSortCallback,
            isSub,
        });
        return (typeof ret == 'number') ? ret : failbackSort(a, b);
    };
    if (transpileBase) {
        fnSortCallback = (function (oldFn) {
            return function (a, b, isSub) {
                if (a === b) {
                    return 0;
                }
                if (isSub) {
                    return oldFn(a, b, isSub);
                }
                return oldFn(transpileBase(a), transpileBase(b), isSub);
            };
        })(fnSortCallback);
    }
    else {
        transpileBase = (input) => input;
    }
    fnSortCallback.failbackSort = failbackSort;
    fnSortCallback.trigger = trigger;
    fnSortCallback.transpile = transpile;
    fnSortCallback.transpileBase = transpileBase;
    fnSortCallback.fnSortCallback = fnSortCallback;
    return fnSortCallback;
}
exports.createSortCallback = createSortCallback;
exports.defaultSortCallback = createSortCallback({
    dotNum: true,
});
exports.default = exports.defaultSortCallback;
function _match(a, b, { r, mainFn, }) {
    let ta;
    let tb;
    if ((ta = r.exec(a)) && (tb = r.exec(b))) {
        let r = parseFloat(ta[0]) - parseFloat(tb[0]);
        if (r !== 0) {
            return r;
        }
        let a1 = ta.input.slice(ta[0].length);
        let b1 = tb.input.slice(tb[0].length);
        if (a1 != b1) {
            let i = 0;
            while (typeof a1[i] != 'undefined' && a1[i] === b1[i] && (!/^\d$/.test(b1[i]))) {
                i++;
            }
            a1 = a1.slice(i);
            b1 = b1.slice(i);
        }
        return mainFn(a1, b1, true);
    }
}
exports._match = _match;
function _trim(input) {
    return input
        .replace(/^[_\s]+(\d+)/, '$1')
        .replace(/^\D(\d+)/, '$1')
        .trim();
}
exports._trim = _trim;
// @ts-ignore
exports = Object.freeze(exports);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgseURBQTBEO0FBMkpqRCx3Q0FBYztBQXpKdkIsSUFBWSxlQUlYO0FBSkQsV0FBWSxlQUFlO0lBRTFCLG1FQUFlLENBQUE7SUFDZiwrRUFBcUIsQ0FBQTtBQUN0QixDQUFDLEVBSlcsZUFBZSxHQUFmLHVCQUFlLEtBQWYsdUJBQWUsUUFJMUI7QUE2Q0Q7OztHQUdHO0FBQ0gsU0FBZ0Isa0JBQWtCLENBQUMsVUFBc0MsRUFBRTtJQUUxRSxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBRXpELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLElBQUksY0FBYyxDQUFDO0lBQzVELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDO0lBQzFDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLElBQUksS0FBSyxDQUFDO0lBQzNDLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFFMUMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUN2QjtRQUNDLElBQUksV0FBK0MsQ0FBQztRQUVwRCxJQUFJLE9BQU8sT0FBTyxDQUFDLFdBQVcsS0FBSyxVQUFVLEVBQzdDO1lBQ0MsV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7U0FDbEM7YUFFRDtZQUNDLElBQUksRUFBRSxHQUFHLGFBQWEsQ0FBQztZQUV2QixJQUFJLE9BQU8sT0FBTyxDQUFDLFdBQVcsS0FBSyxRQUFRLEVBQzNDO2dCQUNDLElBQUksT0FBTyxDQUFDLFdBQVcsS0FBSyxlQUFlLENBQUMsV0FBVyxFQUN2RDtvQkFDQyxFQUFFLEdBQUcsbUJBQW1CLENBQUM7aUJBQ3pCO2FBQ0Q7WUFFRCxXQUFXLEdBQUcs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QztTQUN6QixJQUFJLEVBQUUsQ0FDTjtBQUNILENBQUM7QUFQRCxzQkFPQztBQUVELGFBQWE7QUFDYixPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTgvMi8xMi8wMTIuXG4gKi9cblxuaW1wb3J0IG5hdHVyYWxDb21wYXJlID0gcmVxdWlyZSgnc3RyaW5nLW5hdHVyYWwtY29tcGFyZScpO1xuXG5leHBvcnQgZW51bSBFbnVtVG9Mb3dlckNhc2Vcbntcblx0dG9Mb3dlckNhc2UgPSAxLFxuXHR0b0xvY2FsZUxvd2VyQ2FzZSA9IDIsXG59XG5cbmV4cG9ydCBkZWNsYXJlIGZ1bmN0aW9uIGRlZmF1bHRTb3J0Q2FsbGJhY2soYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlcjtcbmV4cG9ydCBkZWNsYXJlIG5hbWVzcGFjZSBkZWZhdWx0U29ydENhbGxiYWNrXG57XG5cdGV4cG9ydCBmdW5jdGlvbiBmYWlsYmFja1NvcnQoYSwgYik6IG51bWJlclxuXHRleHBvcnQgZnVuY3Rpb24gdHJpZ2dlcihhOiBzdHJpbmcsIGI6IHN0cmluZywgZGF0YTogSVRyaWdnZXJEYXRhKTogbnVtYmVyXG5cdGV4cG9ydCBmdW5jdGlvbiB0cmFuc3BpbGUoaW5wdXQsIGlzU3ViPywgLi4uYXJndik6IHN0cmluZ1xuXHRleHBvcnQgZnVuY3Rpb24gdHJhbnNwaWxlQmFzZShpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nXG5cblx0ZXhwb3J0IGZ1bmN0aW9uIGZuU29ydENhbGxiYWNrKGE6IHN0cmluZywgYjogc3RyaW5nLCBpc1N1Yj86IGJvb2xlYW4pOiBudW1iZXJcbn1cblxuZXhwb3J0IHR5cGUgSUZuU29ydENhbGxiYWNrID0gdHlwZW9mIGRlZmF1bHRTb3J0Q2FsbGJhY2s7XG5cbmV4cG9ydCB0eXBlIElDcmVhdGVTb3J0Q2FsbGJhY2tPcHRpb25zID0ge1xuXHRkb3ROdW0/OiBib29sZWFuLFxuXHQvKipcblx0ICogd2lsbCBjaGFuZ2UgYmFzZSBpbnB1dCB2YWx1ZVxuXHQgKi9cblx0dG9Mb3dlckNhc2U/OiBFbnVtVG9Mb3dlckNhc2UgfCBib29sZWFuIHwgKChpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KSA9PiBzdHJpbmcpLFxufSAmIElGblNvcnRDYWxsYmFja1Byb3A7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUZuU29ydENhbGxiYWNrUHJvcFxue1xuXHQvKipcblx0ICogZmFpbGJhY2sgY29tcGFyZVxuXHQgKi9cblx0ZmFpbGJhY2tTb3J0PyhhLCBiKTogbnVtYmVyLFxuXG5cdC8qKlxuXHQgKiBjb21wYXJlIHRyYW5zcGlsZSB2YWx1ZVxuXHQgKi9cblx0dHJpZ2dlcj8oYTogc3RyaW5nLCBiOiBzdHJpbmcsIGRhdGE6IElUcmlnZ2VyRGF0YSk6IG51bWJlcixcblxuXHQvKipcblx0ICogd2lsbCBjaGFuZ2UgaW5wdXQgdmFsdWUgZm9yIHRyaWdnZXIgb25seVxuXHQgKi9cblx0dHJhbnNwaWxlPyhpbnB1dCwgaXNTdWI/LCAuLi5hcmd2KTogc3RyaW5nLFxuXHQvKipcblx0ICogd2lsbCBjaGFuZ2UgYmFzZSBpbnB1dCB2YWx1ZVxuXHQgKi9cblx0dHJhbnNwaWxlQmFzZT8oaW5wdXQsIGlzU3ViPywgLi4uYXJndik6IHN0cmluZyxcbn1cblxuLyoqXG4gKiBjcmVhdGUgYSBjb21wYXJlIGNhbGxiYWNrIGJ5ICh0cmFuc3BpbGVCYXNlIHZhbHVlKSAtPiB0cmlnZ2VyKHRyYW5zcGlsZSB2YWx1ZSkgLT4gZmFpbGJhY2tTb3J0XG4gKiBAcGFyYW0gb3B0aW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU29ydENhbGxiYWNrKG9wdGlvbnM6IElDcmVhdGVTb3J0Q2FsbGJhY2tPcHRpb25zID0ge30pOiBJRm5Tb3J0Q2FsbGJhY2tcbntcblx0Y29uc3QgciA9IG9wdGlvbnMuZG90TnVtID8gL14oXFxkKyg/OlxcLlxcZCspPykvIDogL14oXFxkKykvO1xuXG5cdGNvbnN0IGZhaWxiYWNrU29ydCA9IG9wdGlvbnMuZmFpbGJhY2tTb3J0IHx8IG5hdHVyYWxDb21wYXJlO1xuXHRjb25zdCB0cmlnZ2VyID0gb3B0aW9ucy50cmlnZ2VyIHx8IF9tYXRjaDtcblx0bGV0IHRyYW5zcGlsZSA9IG9wdGlvbnMudHJhbnNwaWxlIHx8IF90cmltO1xuXHRsZXQgdHJhbnNwaWxlQmFzZSA9IG9wdGlvbnMudHJhbnNwaWxlQmFzZTtcblxuXHRpZiAob3B0aW9ucy50b0xvd2VyQ2FzZSlcblx0e1xuXHRcdGxldCBmbkxvd2VyQ2FzZTogKGlucHV0OiBzdHJpbmcsIC4uLmFyZ3YpID0+IHN0cmluZztcblxuXHRcdGlmICh0eXBlb2Ygb3B0aW9ucy50b0xvd2VyQ2FzZSA9PT0gJ2Z1bmN0aW9uJylcblx0XHR7XG5cdFx0XHRmbkxvd2VyQ2FzZSA9IG9wdGlvbnMudG9Mb3dlckNhc2U7XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHRsZXQgZm4gPSAndG9Mb3dlckNhc2UnO1xuXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbnMudG9Mb3dlckNhc2UgPT09ICdudW1iZXInKVxuXHRcdFx0e1xuXHRcdFx0XHRpZiAob3B0aW9ucy50b0xvd2VyQ2FzZSAhPT0gRW51bVRvTG93ZXJDYXNlLnRvTG93ZXJDYXNlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Zm4gPSAndG9Mb2NhbGVMb3dlckNhc2UnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGZuTG93ZXJDYXNlID0gKGlucHV0OiBzdHJpbmcsIC4uLmFyZ3YpID0+IGlucHV0W2ZuXSguLi5hcmd2KTtcblx0XHR9XG5cblx0XHRpZiAoZm5Mb3dlckNhc2UpXG5cdFx0e1xuXHRcdFx0aWYgKHRyYW5zcGlsZUJhc2UpXG5cdFx0XHR7XG5cdFx0XHRcdHRyYW5zcGlsZUJhc2UgPSAoKG9sZCkgPT4ge1xuXHRcdFx0XHRcdHJldHVybiBmdW5jdGlvbiAoaW5wdXQsIC4uLmFyZ3YpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZuTG93ZXJDYXNlKG9sZChpbnB1dCwgLi4uYXJndiksIC4uLmFyZ3YpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KSh0cmFuc3BpbGVCYXNlKTtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdHtcblx0XHRcdFx0dHJhbnNwaWxlQmFzZSA9IGZuTG93ZXJDYXNlO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdGxldCBmblNvcnRDYWxsYmFjazogSUZuU29ydENhbGxiYWNrID0gZnVuY3Rpb24gZm5Tb3J0Q2FsbGJhY2soYTogc3RyaW5nLCBiOiBzdHJpbmcsIGlzU3ViPzogYm9vbGVhbik6IG51bWJlclxuXHR7XG5cdFx0aWYgKGEgPT09IGIpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXG5cdFx0bGV0IHJldCA9IHRyaWdnZXIodHJhbnNwaWxlKGEsIGlzU3ViKSwgdHJhbnNwaWxlKGIsIGlzU3ViKSwge1xuXHRcdFx0cixcblx0XHRcdG1haW5GbjogZm5Tb3J0Q2FsbGJhY2sgYXMgSUZuU29ydENhbGxiYWNrLFxuXHRcdFx0aXNTdWIsXG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gKHR5cGVvZiByZXQgPT0gJ251bWJlcicpID8gcmV0IDogZmFpbGJhY2tTb3J0KGEsIGIpO1xuXHR9IGFzIElGblNvcnRDYWxsYmFjaztcblxuXHRpZiAodHJhbnNwaWxlQmFzZSlcblx0e1xuXHRcdGZuU29ydENhbGxiYWNrID0gKGZ1bmN0aW9uIChvbGRGbilcblx0XHR7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24gKGE6IHN0cmluZywgYjogc3RyaW5nLCBpc1N1Yj86IGJvb2xlYW4pOiBudW1iZXJcblx0XHRcdHtcblx0XHRcdFx0aWYgKGEgPT09IGIpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyZXR1cm4gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChpc1N1Yilcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiBvbGRGbihhLCBiLCBpc1N1Yik7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gb2xkRm4odHJhbnNwaWxlQmFzZShhKSwgdHJhbnNwaWxlQmFzZShiKSwgaXNTdWIpO1xuXHRcdFx0fSBhcyBJRm5Tb3J0Q2FsbGJhY2tcblx0XHR9KShmblNvcnRDYWxsYmFjayk7XG5cdH1cblx0ZWxzZVxuXHR7XG5cdFx0dHJhbnNwaWxlQmFzZSA9IChpbnB1dDogc3RyaW5nKSA9PiBpbnB1dDtcblx0fVxuXG5cdGZuU29ydENhbGxiYWNrLmZhaWxiYWNrU29ydCA9IGZhaWxiYWNrU29ydDtcblx0Zm5Tb3J0Q2FsbGJhY2sudHJpZ2dlciA9IHRyaWdnZXI7XG5cdGZuU29ydENhbGxiYWNrLnRyYW5zcGlsZSA9IHRyYW5zcGlsZTtcblx0Zm5Tb3J0Q2FsbGJhY2sudHJhbnNwaWxlQmFzZSA9IHRyYW5zcGlsZUJhc2U7XG5cdGZuU29ydENhbGxiYWNrLmZuU29ydENhbGxiYWNrID0gZm5Tb3J0Q2FsbGJhY2s7XG5cblx0cmV0dXJuIGZuU29ydENhbGxiYWNrO1xufVxuXG5leHBvcnQgeyBuYXR1cmFsQ29tcGFyZSB9XG5cbmV4cG9ydHMuZGVmYXVsdFNvcnRDYWxsYmFjayA9IGNyZWF0ZVNvcnRDYWxsYmFjayh7XG5cdGRvdE51bTogdHJ1ZSxcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBleHBvcnRzLmRlZmF1bHRTb3J0Q2FsbGJhY2sgYXMgdHlwZW9mIGRlZmF1bHRTb3J0Q2FsbGJhY2tcblxuZXhwb3J0IGludGVyZmFjZSBJVHJpZ2dlckRhdGFcbntcblx0cjogUmVnRXhwLFxuXHRtYWluRm46IElGblNvcnRDYWxsYmFjayxcblx0aXNTdWI6IGJvb2xlYW4sXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfbWF0Y2goYTogc3RyaW5nLCBiOiBzdHJpbmcsIHtcblx0cixcblx0bWFpbkZuLFxufTogSVRyaWdnZXJEYXRhKVxue1xuXHRsZXQgdGE6IFJlZ0V4cEV4ZWNBcnJheTtcblx0bGV0IHRiOiBSZWdFeHBFeGVjQXJyYXk7XG5cblx0aWYgKCh0YSA9IHIuZXhlYyhhKSkgJiYgKHRiID0gci5leGVjKGIpKSlcblx0e1xuXHRcdGxldCByID0gcGFyc2VGbG9hdCh0YVswXSkgLSBwYXJzZUZsb2F0KHRiWzBdKTtcblxuXHRcdGlmIChyICE9PSAwKVxuXHRcdHtcblx0XHRcdHJldHVybiByO1xuXHRcdH1cblxuXHRcdGxldCBhMSA9IHRhLmlucHV0LnNsaWNlKHRhWzBdLmxlbmd0aCk7XG5cdFx0bGV0IGIxID0gdGIuaW5wdXQuc2xpY2UodGJbMF0ubGVuZ3RoKTtcblxuXHRcdGlmIChhMSAhPSBiMSlcblx0XHR7XG5cdFx0XHRsZXQgaSA9IDA7XG5cblx0XHRcdHdoaWxlICh0eXBlb2YgYTFbaV0gIT0gJ3VuZGVmaW5lZCcgJiYgYTFbaV0gPT09IGIxW2ldICYmICghL15cXGQkLy50ZXN0KGIxW2ldKSkpXG5cdFx0XHR7XG5cdFx0XHRcdGkrKztcblx0XHRcdH1cblxuXHRcdFx0YTEgPSBhMS5zbGljZShpKTtcblx0XHRcdGIxID0gYjEuc2xpY2UoaSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG1haW5GbihhMSwgYjEsIHRydWUpO1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfdHJpbShpbnB1dDogc3RyaW5nKTogc3RyaW5nXG57XG5cdHJldHVybiBpbnB1dFxuXHRcdC5yZXBsYWNlKC9eW19cXHNdKyhcXGQrKS8sICckMScpXG5cdFx0LnJlcGxhY2UoL15cXEQoXFxkKykvLCAnJDEnKVxuXHRcdC50cmltKClcblx0XHQ7XG59XG5cbi8vIEB0cy1pZ25vcmVcbmV4cG9ydHMgPSBPYmplY3QuZnJlZXplKGV4cG9ydHMpO1xuIl19